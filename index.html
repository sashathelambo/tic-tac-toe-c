<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Game</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-gap: 10px;
            margin: 20px auto;
        }
        
        .cell {
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            background-color: #61dafb;
            border: 2px solid #20232a;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        
        .cell:hover {
            background-color: #21a1f1;
            transform: scale(1.1);
        }
        
        .cell.x {
            color: #ff6b6b;
        }
        
        .cell.o {
            color: #4db6ac;
        }
        
        .active-mode {
            border: 2px solid #fff;
        }
    </style>
</head>

<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <h1 class="text-4xl font-bold text-blue-400 mb-4">Welcome to Tic-Tac-Toe!</h1>
    <div class="instructions bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg text-center">
        <h2 class="text-2xl font-semibold text-blue-400 mb-4">Instructions</h2>
        <p class="mb-4">This is a web-based Tic-Tac-Toe game. Click on a cell to make a move. The first player to align three of their marks in a row, column, or diagonal wins!</p>
    </div>
    <div class="board"></div>
    <div id="message" class="text-xl mt-4"></div>
    <button id="resetBtn" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded">Reset Game</button>
    <div class="mt-4">
        <button id="playerVsPlayerBtn" class="bg-green-500 text-white px-4 py-2 rounded">Player vs Player</button>
        <button id="playerVsComputerBtn" class="bg-red-500 text-white px-4 py-2 rounded">Player vs Computer</button>
    </div>
    <div class="mt-4">
        <button id="easyBtn" class="bg-yellow-500 text-white px-4 py-2 rounded">Easy</button>
        <button id="mediumBtn" class="bg-orange-500 text-white px-4 py-2 rounded">Medium</button>
        <button id="hardBtn" class="bg-purple-500 text-white px-4 py-2 rounded">Hard</button>
    </div>
    <div class="mt-4">
        <button id="darkModeBtn" class="bg-gray-700 text-white px-4 py-2 rounded">Dark Mode</button>
        <button id="lightModeBtn" class="bg-gray-300 text-black px-4 py-2 rounded">Light Mode</button>
    </div>
    <footer class="mt-auto text-gray-500">
        <p>&copy; 2024 Tic-Tac-Toe Game. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        const boardElement = document.querySelector('.board');
        const messageElement = document.getElementById('message');
        const resetBtn = document.getElementById('resetBtn');
        const playerVsPlayerBtn = document.getElementById('playerVsPlayerBtn');
        const playerVsComputerBtn = document.getElementById('playerVsComputerBtn');
        const easyBtn = document.getElementById('easyBtn');
        const mediumBtn = document.getElementById('mediumBtn');
        const hardBtn = document.getElementById('hardBtn');
        const darkModeBtn = document.getElementById('darkModeBtn');
        const lightModeBtn = document.getElementById('lightModeBtn');

        let board = Array.from({
            length: 9
        }, (_, i) => (i + 1).toString());
        let currentPlayer = 'X';
        let isPlayerVsComputer = false;
        let difficulty = 'medium';
        let socket = io();

        // Function to display the Tic-Tac-Toe board
        function displayBoard() {
            boardElement.innerHTML = '';
            board.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell');
                cellElement.textContent = cell;
                cellElement.addEventListener('click', () => handlePlayerInput(index));
                boardElement.appendChild(cellElement);
            });
        }

        // Function to check if a player has won
        function checkWin(marker) {
            const winPatterns = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8], // rows
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8], // columns
                [0, 4, 8],
                [2, 4, 6] // diagonals
            ];

            return winPatterns.some(pattern =>
                pattern.every(index => board[index] === marker)
            );
        }

        // Function to check if the game is a draw
        function isDraw() {
            return board.every(cell => cell === 'X' || cell === 'O');
        }

        // Function to reset the board
        function resetBoard() {
            board = Array.from({
                length: 9
            }, (_, i) => (i + 1).toString());
            currentPlayer = 'X';
            messageElement.textContent = '';
            displayBoard();
            socket.emit('resetBoard');
        }

        // Function to handle player input
        function handlePlayerInput(index) {
            if (board[index] === 'X' || board[index] === 'O') {
                messageElement.textContent = 'Cell already taken. Please choose another position.';
                return;
            }

            board[index] = currentPlayer;
            displayBoard();

            if (checkWin(currentPlayer)) {
                messageElement.textContent = `Player ${currentPlayer} wins!`;
                socket.emit('gameOver', `Player ${currentPlayer} wins!`);
                return;
            }

            if (isDraw()) {
                messageElement.textContent = "It's a draw!";
                socket.emit('gameOver', "It's a draw!");
                return;
            }

            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            socket.emit('playerMove', {
                board,
                currentPlayer
            });

            if (isPlayerVsComputer && currentPlayer === 'O') {
                handleComputerMove();
            }
        }

        // Function to handle computer move
        function handleComputerMove() {
            const availableCells = board.map((cell, index) => cell === 'X' || cell === 'O' ? null : index).filter(index => index !== null);
            let bestMove;
            if (difficulty === 'easy') {
                bestMove = availableCells[Math.floor(Math.random() * availableCells.length)];
            } else if (difficulty === 'medium') {
                bestMove = findBestMoveMedium();
            } else {
                bestMove = findBestMove();
            }
            handlePlayerInput(bestMove);
        }

        // Function to find the best move for the computer (medium difficulty)
        function findBestMoveMedium() {
            // Simple AI that blocks the player from winning
            for (let i = 0; i < board.length; i++) {
                if (board[i] !== 'X' && board[i] !== 'O') {
                    let temp = board[i];
                    board[i] = 'O';
                    if (checkWin('O')) {
                        board[i] = temp;
                        return i;
                    }
                    board[i] = 'X';
                    if (checkWin('X')) {
                        board[i] = temp;
                        return i;
                    }
                    board[i] = temp;
                }
            }
            const availableCells = board.map((cell, index) => cell === 'X' || cell === 'O' ? null : index).filter(index => index !== null);
            return availableCells[Math.floor(Math.random() * availableCells.length)];
        }

        // Function to find the best move for the computer (hard difficulty)
        function findBestMove() {
            let bestScore = -Infinity;
            let move;
            for (let i = 0; i < board.length; i++) {
                if (board[i] !== 'X' && board[i] !== 'O') {
                    let temp = board[i];
                    board[i] = 'O';
                    let score = minimax(board, 0, false);
                    board[i] = temp;
                    if (score > bestScore) {
                        bestScore = score;
                        move = i;
                    }
                }
            }
            return move;
        }

        // Minimax algorithm
        function minimax(board, depth, isMaximizing) {
            if (checkWin('O')) {
                return 10 - depth;
            }
            if (checkWin('X')) {
                return depth - 10;
            }
            if (isDraw()) {
                return 0;
            }

            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let i = 0; i < board.length; i++) {
                    if (board[i] !== 'X' && board[i] !== 'O') {
                        let temp = board[i];
                        board[i] = 'O';
                        let score = minimax(board, depth + 1, false);
                        board[i] = temp;
                        bestScore = Math.max(score, bestScore);
                    }
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let i = 0; i < board.length; i++) {
                    if (board[i] !== 'X' && board[i] !== 'O') {
                        let temp = board[i];
                        board[i] = 'X';
                        let score = minimax(board, depth + 1, true);
                        board[i] = temp;
                        bestScore = Math.min(score, bestScore);
                    }
                }
                return bestScore;
            }
        }

        // Add reset event listener
        resetBtn.addEventListener('click', resetBoard);

        // Add mode selection event listeners
        playerVsPlayerBtn.addEventListener('click', () => {
            isPlayerVsComputer = false;
            resetBoard();
            playerVsPlayerBtn.classList.add('active-mode');
            playerVsComputerBtn.classList.remove('active-mode');
        });

        playerVsComputerBtn.addEventListener('click', () => {
            isPlayerVsComputer = true;
            resetBoard();
            playerVsComputerBtn.classList.add('active-mode');
            playerVsPlayerBtn.classList.remove('active-mode');
        });

        // Add difficulty selection event listeners
        easyBtn.addEventListener('click', () => {
            difficulty = 'easy';
            easyBtn.classList.add('active-mode');
            mediumBtn.classList.remove('active-mode');
            hardBtn.classList.remove('active-mode');
            isPlayerVsComputer = false;
            playerVsComputerBtn.classList.remove('active-mode');
            playerVsPlayerBtn.classList.add('active-mode');
        });

        mediumBtn.addEventListener('click', () => {
            difficulty = 'medium';
            mediumBtn.classList.add('active-mode');
            easyBtn.classList.remove('active-mode');
            hardBtn.classList.remove('active-mode');
            isPlayerVsComputer = false;
            playerVsComputerBtn.classList.remove('active-mode');
            playerVsPlayerBtn.classList.add('active-mode');
        });

        hardBtn.addEventListener('click', () => {
            difficulty = 'hard';
            hardBtn.classList.add('active-mode');
            easyBtn.classList.remove('active-mode');
            mediumBtn.classList.remove('active-mode');
            isPlayerVsComputer = false;
            playerVsComputerBtn.classList.remove('active-mode');
            playerVsPlayerBtn.classList.add('active-mode');
        });

        // Add theme selection event listeners
        darkModeBtn.addEventListener('click', () => {
            document.body.classList.add('bg-gray-900', 'text-white');
            document.body.classList.remove('bg-white', 'text-black');
        });

        lightModeBtn.addEventListener('click', () => {
            document.body.classList.add('bg-white', 'text-black');
            document.body.classList.remove('bg-gray-900', 'text-white');
        });

        // Initial display
        displayBoard();

        // Socket event listeners
        socket.on('playerMove', ({
            board: newBoard,
            currentPlayer: newCurrentPlayer
        }) => {
            board = newBoard;
            currentPlayer = newCurrentPlayer;
            displayBoard();
        });

        socket.on('resetBoard', () => {
            resetBoard();
        });

        socket.on('gameOver', (message) => {
            messageElement.textContent = message;
        });
    </script>
</body>

</html>