<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Game</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.x.x/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, minmax(80px, 1fr));
            grid-gap: 10px;
            margin: 20px auto;
            max-width: 300px;
        }
        
        .cell {
            width: 100%;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            background-color: #61dafb;
            border: 2px solid #20232a;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        
        .cell:hover {
            background-color: #21a1f1;
            transform: scale(1.1);
        }
        
        .cell.x {
            color: #ff6b6b;
        }
        
        .cell.o {
            color: #4db6ac;
        }
        
        .cell.win {
            animation: highlightWin 1s infinite alternate;
        }
        
        @keyframes highlightWin {
            from {
                background-color: #ffeb3b;
            }
            to {
                background-color: #ffc107;
            }
        }
        
        .active-mode {
            border: 2px solid #fff;
        }
    </style>
</head>

<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <h1 class="text-4xl font-bold text-blue-400 mb-4">Welcome to Tic-Tac-Toe!</h1>
    <div class="instructions bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg text-center">
        <h2 class="text-2xl font-semibold text-blue-400 mb-4">Instructions</h2>
        <p class="mb-4">This is a web-based Tic-Tac-Toe game. Click on a cell to make a move. The first player to align three of their marks in a row, column, or diagonal wins!</p>
    </div>
    <div id="menu" class="mt-4 flex flex-col items-center">
        <button id="createLobbyBtn" class="bg-green-500 text-white px-4 py-2 rounded mb-2">Create Lobby</button>
        <button id="joinLobbyBtn" class="bg-blue-500 text-white px-4 py-2 rounded mb-2">Join Lobby</button>
        <div id="joinLobbySection" class="hidden mt-4 flex flex-col items-center">
            <input type="text" id="lobbyIdInput" placeholder="Enter Lobby ID" class="p-2 rounded bg-gray-800 text-white mb-2">
            <button id="confirmJoinLobbyBtn" class="bg-blue-500 text-white px-4 py-2 rounded mb-2">Join Lobby</button>
            <label class="ml-2 text-sm"><input type="checkbox" id="spectatorMode" class="mr-2">Spectator Mode</label>
        </div>
    </div>
    <div id="lobby" class="hidden mt-4 flex flex-col items-center">
        <h2 class="text-2xl font-semibold text-blue-400 mb-4">Lobby</h2>
        <div id="lobbyId" class="text-xl mb-4"></div>
        <button id="startGameBtn" class="bg-red-500 text-white px-4 py-2 rounded">Start Game</button>
    </div>
    <div class="board hidden"></div>
    <div id="message" class="text-xl mt-4"></div>
    <button id="resetBtn" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hidden">Reset Game</button>
    <div class="mt-4 hidden flex flex-col items-center">
        <button id="playerVsPlayerBtn" class="bg-green-500 text-white px-4 py-2 rounded mb-2">Player vs Player</button>
        <button id="playerVsComputerBtn" class="bg-red-500 text-white px-4 py-2 rounded">Player vs Computer</button>
    </div>
    <button id="toggleDarkMode" class="mt-4 bg-gray-600 text-white px-4 py-2 rounded">Toggle Dark Mode</button>
    <footer class="mt-auto text-gray-500 text-center">
        <p>&copy; 2024 Tic-Tac-Toe Game. All rights reserved.</p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script>
    <script>
        const boardElement = document.querySelector('.board');
        const messageElement = document.getElementById('message');
        const resetBtn = document.getElementById('resetBtn');
        const playerVsPlayerBtn = document.getElementById('playerVsPlayerBtn');
        const playerVsComputerBtn = document.getElementById('playerVsComputerBtn');
        const createLobbyBtn = document.getElementById('createLobbyBtn');
        const joinLobbyBtn = document.getElementById('joinLobbyBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const joinLobbySection = document.getElementById('joinLobbySection');
        const confirmJoinLobbyBtn = document.getElementById('confirmJoinLobbyBtn');
        const spectatorModeCheckbox = document.getElementById('spectatorMode');
        const menu = document.getElementById('menu');
        const lobby = document.getElementById('lobby');
        const lobbyIdElement = document.getElementById('lobbyId');
        const toggleDarkMode = document.getElementById('toggleDarkMode');

        let board = Array.from({
            length: 9
        }, (_, i) => (i + 1).toString());
        let currentPlayer = 'X';
        let isPlayerVsComputer = false;
        let socket = io();
        let lobbyId = null;
        let spectatorMode = false;
        let difficulty = 'hard'; // Difficulty level for AI (easy/hard)

        // Function to display the Tic-Tac-Toe board
        function displayBoard() {
            boardElement.innerHTML = '';
            board.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell');
                cellElement.textContent = cell;
                cellElement.addEventListener('click', () => handlePlayerInput(index));
                boardElement.appendChild(cellElement);
            });
        }

        // Function to check if a player has won
        function checkWin(marker) {
            const winPatterns = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8], // rows
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8], // columns
                [0, 4, 8],
                [2, 4, 6] // diagonals
            ];

            return winPatterns.some(pattern =>
                pattern.every(index => board[index] === marker)
            );
        }

        // Function to check if the game is a draw
        function isDraw() {
            return board.every(cell => cell === 'X' || cell === 'O');
        }

        // Function to reset the board
        function resetBoard() {
            board = Array.from({
                length: 9
            }, (_, i) => (i + 1).toString());
            currentPlayer = 'X';
            messageElement.textContent = '';
            displayBoard();
            socket.emit('resetBoard', {
                lobbyId
            });
        }

        // Function to handle player input
        function handlePlayerInput(index) {
            if (board[index] === 'X' || board[index] === 'O') {
                messageElement.textContent = 'Cell already taken. Please choose another position.';
                return;
            }

            board[index] = currentPlayer;
            displayBoard();

            if (checkWin(currentPlayer)) {
                messageElement.textContent = `Player ${currentPlayer} wins!`;
                highlightWinningCells();
                socket.emit('gameOver', {
                    message: `Player ${currentPlayer} wins!`,
                    lobbyId
                });
                return;
            }

            if (isDraw()) {
                messageElement.textContent = "It's a draw!";
                socket.emit('gameOver', {
                    message: "It's a draw!",
                    lobbyId
                });
                return;
            }

            currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            socket.emit('playerMove', {
                board,
                currentPlayer,
                lobbyId
            });

            if (isPlayerVsComputer && currentPlayer === 'O') {
                handleComputerMove();
            }
        }

        // Function to highlight winning cells
        function highlightWinningCells() {
            const winPatterns = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6]
            ];
            winPatterns.forEach(pattern => {
                if (pattern.every(index => board[index] === currentPlayer)) {
                    pattern.forEach(index => document.querySelectorAll('.cell')[index].classList.add('win'));
                }
            });
        }

        // Function for computer move (AI)
        function handleComputerMove() {
            const bestMove = difficulty === 'hard' ? findBestMove() : findRandomMove();
            handlePlayerInput(bestMove);
        }

        // Function to find a random move (easy AI)
        function findRandomMove() {
            const availableMoves = board.map((val, idx) => (val === 'X' || val === 'O' ? null : idx)).filter(val => val !== null);
            return availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }

        // Toggle dark mode
        toggleDarkMode.addEventListener('click', () => {
            document.body.classList.toggle('bg-gray-900');
            document.body.classList.toggle('bg-white');
            document.body.classList.toggle('text-black');
        });

        // Additional socket handlers for game state synchronization, lobby creation, etc.
        socket.on('connect', () => {
            console.log('Connected to server.');
        });

        socket.on('updateBoard', (data) => {
            board = data.board;
            currentPlayer = data.currentPlayer;
            displayBoard();
        });

        socket.on('gameOver', (data) => {
            messageElement.textContent = data.message;
        });
    </script>
</body>

</html>