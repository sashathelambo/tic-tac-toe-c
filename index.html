<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe Game</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .board {
            display: grid;
            grid-template-columns: repeat(3, 100px);
            grid-gap: 10px;
            margin: 20px auto;
        }
        
        .cell {
            width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            background-color: #61dafb;
            border: 2px solid #20232a;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
        }
        
        .cell:hover {
            background-color: #21a1f1;
            transform: scale(1.1);
        }
        
        .cell.x {
            color: #ff6b6b;
        }
        
        .cell.o {
            color: #4db6ac;
        }
        
        .active-mode {
            border: 2px solid #fff;
        }
        
        .highlight {
            background-color: #ffeb3b;
        }
        
        @media (max-width: 600px) {
            .board {
                grid-template-columns: repeat(3, 80px);
                grid-gap: 5px;
            }
            .cell {
                width: 80px;
                height: 80px;
                font-size: 1.5em;
            }
        }
        
        button {
            transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
            background-color: #007bff;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        .clicked {
            background-color: #ff0000;
        }
        
        #scoreBoard p {
            text-align: center;
        }
    </style>
</head>

<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen p-4">
    <h1 class="text-4xl font-bold text-blue-400 mb-4">Welcome to Tic-Tac-Toe!</h1>
    <div class="instructions bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg text-center">
        <h2 class="text-2xl font-semibold text-blue-400 mb-4">Instructions</h2>
        <p class="mb-4">This is a web-based Tic-Tac-Toe game. Click on a cell to make a move. The first player to align three of their marks in a row, column, or diagonal wins!</p>
    </div>
    <div class="mt-4">
        <h2 class="text-2xl font-semibold text-blue-400 mb-4 text-center">Scores</h2>
        <div id="scoreBoard" class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg text-center">
            <p id="scoreX" class="text-xl">Player X: 0</p>
            <p id="scoreO" class="text-xl">Player O: 0</p>
        </div>
    </div>
    <div class="mt-4 flex items-center">
        <button id="chooseXBtn" class="bg-blue-500 text-white px-4 py-2 rounded">Choose X</button>
        <button id="chooseOBtn" class="bg-red-500 text-white px-4 py-2 rounded">Choose O</button>
        <div id="chosenSymbol" class="ml-4 text-xl"></div>
        <div id="symbolIndicator" class="ml-4 text-2xl"></div>
    </div>
    <div class="board" role="grid" aria-label="Tic-Tac-Toe Board"></div>
    <div id="message" class="text-xl mt-4" aria-live="polite"></div>
    <button id="resetBtn" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded">Reset Game</button>
    <div class="mt-4">
        <button id="playerVsPlayerBtn" class="bg-green-500 text-white px-4 py-2 rounded">Player vs Player</button>
        <button id="playerVsComputerBtn" class="bg-red-500 text-white px-4 py-2 rounded">Player vs Computer</button>
    </div>
    <div class="mt-4">
        <button id="easyBtn" class="bg-yellow-500 text-white px-4 py-2 rounded">Easy</button>
        <button id="mediumBtn" class="bg-orange-500 text-white px-4 py-2 rounded">Medium</button>
        <button id="hardBtn" class="bg-purple-500 text-white px-4 py-2 rounded">Hard</button>
        <button id="extremeBtn" class="bg-indigo-500 text-white px-4 py-2 rounded">Extreme</button>
    </div>
    <div class="mt-4">
        <h2 class="text-2xl font-semibold text-blue-400 mb-4">Game History</h2>
        <ul id="gameHistory" class="bg-gray-800 p-6 rounded-lg shadow-lg max-w-lg text-center"></ul>
    </div>
    <footer class="mt-auto text-gray-500">
        <p>&copy; 2024 Tic-Tac-Toe Game. All rights reserved.</p>
    </footer>

    <script>
        const boardElement = document.querySelector('.board');
        const messageElement = document.getElementById('message');
        const resetBtn = document.getElementById('resetBtn');
        const playerVsPlayerBtn = document.getElementById('playerVsPlayerBtn');
        const playerVsComputerBtn = document.getElementById('playerVsComputerBtn');
        const easyBtn = document.getElementById('easyBtn');
        const mediumBtn = document.getElementById('mediumBtn');
        const hardBtn = document.getElementById('hardBtn');
        const extremeBtn = document.getElementById('extremeBtn');
        const gameHistoryElement = document.getElementById('gameHistory');
        const chooseXBtn = document.getElementById('chooseXBtn');
        const chooseOBtn = document.getElementById('chooseOBtn');
        const chosenSymbolElement = document.getElementById('chosenSymbol');
        const symbolIndicator = document.getElementById('symbolIndicator');

        let board = Array.from({
            length: 9
        }, (_, i) => (i + 1).toString());
        let currentPlayer = '';
        let computerPlayer = '';
        let isPlayerVsComputer = false;
        let difficulty = 'medium';
        let gameHistory = [];
        let scoreX = 0;
        let scoreO = 0;

        function displayBoard(board) {
            boardElement.innerHTML = '';
            board.forEach((cell, index) => {
                const cellElement = document.createElement('div');
                cellElement.classList.add('cell');
                cellElement.textContent = cell;
                cellElement.addEventListener('click', () => handleClick(index));
                boardElement.appendChild(cellElement);

                if (cell === 'X') {
                    cellElement.classList.add('x');
                } else if (cell === 'O') {
                    cellElement.classList.add('o');
                }
            });
        }

        function isCellOccupied(index) {
            return board[index] === 'X' || board[index] === 'O';
        }

        function checkWin(board) {
            const winPatterns = [
                [0, 1, 2],
                [3, 4, 5],
                [6, 7, 8],
                [0, 3, 6],
                [1, 4, 7],
                [2, 5, 8],
                [0, 4, 8],
                [2, 4, 6]
            ];

            for (const pattern of winPatterns) {
                const [a, b, c] = pattern;
                if (board[a] && board[a] === board[b] && board[a] === board[c]) {
                    return pattern; // Return winning pattern
                }
            }

            return null; // No winner yet
        }

        function isDraw(board) {
            return board.every(cell => cell === 'X' || cell === 'O');
        }

        function resetBoard() {
            board = Array.from({
                length: 9
            }, (_, i) => (i + 1).toString());
            currentPlayer = '';
            computerPlayer = '';
            messageElement.textContent = '';
            displayBoard(board);
            gameHistory = [];
            gameHistoryElement.innerHTML = '';
            chooseXBtn.disabled = false;
            chooseOBtn.disabled = false;
            chosenSymbolElement.textContent = '';
            symbolIndicator.textContent = '';
        }

        function setPlayerChoice(choice) {
            currentPlayer = choice;
            computerPlayer = choice === 'X' ? 'O' : 'X';
            chooseXBtn.disabled = true;
            chooseOBtn.disabled = true;
            chosenSymbolElement.textContent = `Chosen: ${choice}`;
            symbolIndicator.textContent = choice;

            // If it's player vs computer and the computer is 'X', make the first move
            if (isPlayerVsComputer && computerPlayer === 'X') {
                setTimeout(() => {
                    computerMove();
                }, 500); // Delay to simulate thinking time
            }
        }

        function handleClick(index) {
            if (!currentPlayer) {
                messageElement.textContent = 'Please choose X or O to start the game.';
                return;
            }
            if (!isCellOccupied(index) && !checkWin(board)) {
                board[index] = currentPlayer;
                console.log(`Player placed ${currentPlayer} at position ${index + 1}`);
                displayBoard(board);

                const winningPattern = checkWin(board);
                if (winningPattern) {
                    highlightWinningCells(winningPattern);
                    messageElement.textContent = `${currentPlayer} wins!`;
                    addToGameHistory(`${currentPlayer} wins!`);
                    updateScore(currentPlayer); // Update score
                    return;
                }

                if (isDraw(board)) {
                    messageElement.textContent = 'It\'s a draw!';
                    addToGameHistory('It\'s a draw!');
                    return;
                }

                // Switch current player only if it's player vs player
                if (!isPlayerVsComputer) {
                    currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
                }

                if (isPlayerVsComputer && currentPlayer === computerPlayer) {
                    setTimeout(() => {
                        computerMove();
                    }, 500); // Delay to simulate thinking time
                }
            }
        }

        function computerMove() {
            let bestMove;

            if (difficulty === "easy") {
                bestMove = getRandomAvailableMove();
            } else if (difficulty === "medium") {
                bestMove = getMediumDifficultyMove();
            } else if (difficulty === "hard") {
                bestMove = getHardDifficultyMove();
            } else if (difficulty === "extreme") {
                bestMove = getExtremeDifficultyMove();
            }

            board[bestMove] = computerPlayer; // Ensure the computer places its own symbol
            console.log(`Computer placed ${computerPlayer} at position ${bestMove + 1}`);
            displayBoard(board);

            const winningPattern = checkWin(board);
            if (winningPattern) {
                highlightWinningCells(winningPattern);
                messageElement.textContent = `${computerPlayer} wins!`;
                addToGameHistory(`${computerPlayer} wins!`);
                updateScore(computerPlayer); // Update score
                return;
            }

            if (isDraw(board)) {
                messageElement.textContent = 'It\'s a draw!';
                addToGameHistory('It\'s a draw!');
                return;
            }

            // Switch current player only if it's player vs computer
            if (isPlayerVsComputer) {
                currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
            }
        }

        function getRandomAvailableMove() {
            const availableMoves = board
                .map((cell, index) => (!isCellOccupied(index) ? index : null))
                .filter(index => index !== null);
            const randomIndex = Math.floor(Math.random() * availableMoves.length);
            return availableMoves[randomIndex];
        }

        function getMediumDifficultyMove() {
            const availableMoves = board
                .map((cell, index) => (!isCellOccupied(index) ? index : null))
                .filter(index => index !== null);

            const winningMove = availableMoves.find(index => {
                const tempBoard = [...board];
                tempBoard[index] = computerPlayer;
                return checkWin(tempBoard);
            });
            if (winningMove !== undefined) {
                return winningMove;
            }
            const blockingMove = availableMoves.find(index => {
                const tempBoard = [...board];
                tempBoard[index] = currentPlayer;
                return checkWin(tempBoard);
            });

            if (blockingMove !== undefined) {
                return blockingMove;
            }
            return getRandomAvailableMove();
        }

        function getHardDifficultyMove() {
            return getMinimaxMove(board, computerPlayer);
        }

        function getExtremeDifficultyMove() {
            const availableMoves = board
                .map((cell, index) => (!isCellOccupied(index) ? index : null))
                .filter(index => index !== null);

            for (let move of availableMoves) {
                const tempBoard = [...board];
                tempBoard[move] = computerPlayer;
                if (checkWin(tempBoard)) {
                    return move;
                }
            }

            const opponent = computerPlayer === 'X' ? 'O' : 'X';
            for (let move of availableMoves) {
                const tempBoard = [...board];
                tempBoard[move] = opponent;
                if (checkWin(tempBoard)) {
                    return move;
                }
            }

            return getMinimaxMove(board, computerPlayer);
        }

        function getMinimaxMove(board, player) {
            const availableMoves = board
                .map((cell, index) => (!isCellOccupied(index) ? index : null))
                .filter(index => index !== null);

            let bestScore = -Infinity;
            let bestMove;

            for (let move of availableMoves) {
                board[move] = player;
                const score = minimax(board, 0, false, player);
                board[move] = (move + 1).toString();

                if (score > bestScore) {
                    bestScore = score;
                    bestMove = move;
                }
            }

            return bestMove;
        }

        function minimax(board, depth, isMaximizing, player) {
            const opponent = player === 'X' ? 'O' : 'X';
            const winnerPattern = checkWin(board);

            if (winnerPattern) {
                if (board[winnerPattern[0]] === player) {
                    return 10 - depth;
                } else {
                    return depth - 10;
                }
            }

            if (isDraw(board)) {
                return 0;
            }

            const availableMoves = board
                .map((cell, index) => (!isCellOccupied(index) ? index : null))
                .filter(index => index !== null);

            if (isMaximizing) {
                let bestScore = -Infinity;
                for (let move of availableMoves) {
                    board[move] = player;
                    const score = minimax(board, depth + 1, false, player);
                    board[move] = (move + 1).toString();
                    bestScore = Math.max(score, bestScore);
                }
                return bestScore;
            } else {
                let bestScore = Infinity;
                for (let move of availableMoves) {
                    board[move] = opponent;
                    const score = minimax(board, depth + 1, true, player);
                    board[move] = (move + 1).toString();
                    bestScore = Math.min(score, bestScore);
                }
                return bestScore;
            }
        }

        function highlightWinningCells(pattern) {
            pattern.forEach(index => {
                boardElement.children[index].classList.add('highlight');
            });
        }

        function addToGameHistory(result) {
            gameHistory.push(result);
            updateGameHistoryDisplay();
        }

        function updateGameHistoryDisplay() {
            gameHistoryElement.innerHTML = '';
            gameHistory.forEach(result => {
                const listItem = document.createElement('li');
                listItem.textContent = result;
                gameHistoryElement.appendChild(listItem);
            });
        }

        function updateScore(winner) {
            if (winner === 'X') {
                scoreX++;
                document.getElementById('scoreX').textContent = `Player X: ${scoreX}`;
            } else if (winner === 'O') {
                scoreO++;
                document.getElementById('scoreO').textContent = `Player O: ${scoreO}`;
            }
        }

        resetBtn.addEventListener('click', resetBoard);

        playerVsPlayerBtn.addEventListener('click', () => {
            isPlayerVsComputer = false;
            resetBoard();
            playerVsPlayerBtn.classList.add('active-mode');
            playerVsComputerBtn.classList.remove('active-mode');
        });

        playerVsComputerBtn.addEventListener('click', () => {
            isPlayerVsComputer = true;
            resetBoard();
            playerVsComputerBtn.classList.add('active-mode');
            playerVsPlayerBtn.classList.remove('active-mode');
        });

        easyBtn.addEventListener('click', () => {
            difficulty = 'easy';
            easyBtn.classList.add('active-mode');
            mediumBtn.classList.remove('active-mode');
            hardBtn.classList.remove('active-mode');
            extremeBtn.classList.remove('active-mode');
        });

        mediumBtn.addEventListener('click', () => {
            difficulty = 'medium';
            mediumBtn.classList.add('active-mode');
            easyBtn.classList.remove('active-mode');
            hardBtn.classList.remove('active-mode');
            extremeBtn.classList.remove('active-mode');
        });

        hardBtn.addEventListener('click', () => {
            difficulty = 'hard';
            hardBtn.classList.add('active-mode');
            easyBtn.classList.remove('active-mode');
            mediumBtn.classList.remove('active-mode');
            extremeBtn.classList.remove('active-mode');
        });

        extremeBtn.addEventListener('click', () => {
            difficulty = 'extreme';
            extremeBtn.classList.add('active-mode');
            easyBtn.classList.remove('active-mode');
            mediumBtn.classList.remove('active-mode');
            hardBtn.classList.remove('active-mode');
        });

        socket.on('playerMove', ({
            board: newBoard,
            currentPlayer: newCurrentPlayer
        }) => {
            board = newBoard;
            currentPlayer = newCurrentPlayer;
            displayBoard(board);
        });

        socket.on('resetBoard', () => {
            resetBoard();
        });

        socket.on('gameOver', (message) => {
            messageElement.textContent = message;
            playSound('gameOver');
        });

        function toggleButtonColor(button) {
            if (button.id !== 'resetBtn') {
                button.classList.toggle('clicked');
            }
        }

        const buttons = document.querySelectorAll('button');
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                toggleButtonColor(button);
            });
        });

        displayBoard(board);

        function testCheckWin() {
            console.assert(checkWin(['X', 'X', 'X', 4, 5, 6, 7, 8, 9]) !== null, 'Test failed: Horizontal win not detected');
            console.assert(checkWin([1, 2, 3, 'O', 'O', 'O', 7, 8, 9]) !== null, 'Test failed: Horizontal win not detected');
            console.assert(checkWin([1, 2, 3, 4, 5, 6, 'X', 'X', 'X']) !== null, 'Test failed: Horizontal win not detected');
            console.assert(checkWin(['X', 2, 3, 'X', 5, 6, 'X', 8, 9]) !== null, 'Test failed: Vertical win not detected');
            console.assert(checkWin([1, 'O', 3, 4, 'O', 6, 7, 'O', 9]) !== null, 'Test failed: Vertical win not detected');
            console.assert(checkWin(['X', 2, 3, 4, 'X', 6, 7, 8, 'X']) !== null, 'Test failed: Diagonal win not detected');
            console.assert(checkWin([1, 2, 'O', 4, 'O', 6, 'O', 8, 9]) !== null, 'Test failed: Diagonal win not detected');
        }

        function testIsDraw() {
            console.assert(isDraw(['X', 'O', 'X', 'O', 'X', 'X', 'O', 'X', 'O']) === true, 'Test failed: Draw not detected');
            console.assert(isDraw(['X', 'O', 'X', 'O', 'X', 'X', 'O', 'X', 9]) === false, 'Test failed: Incorrect draw detection');
        }

        function testIsCellOccupied() {
            console.assert(isCellOccupied(0) === false, 'Test failed: Cell should not be occupied');
            board[0] = 'X';
            console.assert(isCellOccupied(0) === true, 'Test failed: Cell should be occupied');
        }

        function runTests() {
            testCheckWin();
            testIsDraw();
            testIsCellOccupied();
            console.log('All tests completed.');
        }

        runTests();

        easyBtn.classList.add('active-mode');

        chooseXBtn.addEventListener('click', () => {
            setPlayerChoice('X');
        });

        chooseOBtn.addEventListener('click', () => {
            setPlayerChoice('O');
        });
    </script>
</body>

</html>